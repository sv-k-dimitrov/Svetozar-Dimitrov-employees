import csv
from datetime import datetime, date
from collections import defaultdict
from itertools import combinations

csv_file_path = 'csvfile.csv'

def load_csv_file(csv_file):
    projects = defaultdict(list)
    with open(csv_file, 'r') as employees_projects:
        csv_reader = csv.DictReader(employees_projects)
        for row in csv_reader:
            projects[int(row['ProjectID'].strip())].append((
                int(row['EmpID'].strip()),
                date_format(row['DateFrom'].strip()),
                date_format(row['DateTo'].strip())
            ))
    return projects

def employees_who_worked_together_most(file_path):
    projects = load_csv_file(file_path)
    
    pair_employees, matching_days = fetch_employees_match(projects)
    
    years, months, days = convert_days_to_year_moth_day(matching_days)
    
    if pair_employees is not None:
        id_first, id_second = pair_employees
        return f"Employees {id_first} and {id_second} are the pair of coworkers who have worked together on common projects for the longest period of time: {years} years, {months} months, and {days} days."
    else:
        return "No coworkers match found."

def fetch_employees_match(projects):
    max_matching_days, employees_match = max(
                ((min(first_end_date, second_end_date) - max(first_start_date, second_start_date)).days, (id_first, id_second))
                    for project in projects.values()
                    for (id_first, first_start_date, first_end_date), (id_second, second_start_date, second_end_date)
                    in combinations(project, 2)
    )
    
    return employees_match, max_matching_days

def date_format(date_str):
    date_formats = [
        '%Y-%m-%d',
        '%m/%d/%Y',
        '%m-%d-%Y',
        '%d-%m-%Y',
        '%Y/%m/%d',
        '%d/%m/%Y',
        '%m.%d.%Y',
        '%d.%m.%Y'
    ]
    if date_str == 'NULL':
        return date.today()
    
    for format in date_formats:
        try:
            return datetime.strptime(date_str, format).date()
        except ValueError:
            continue
    
    raise ValueError(f"Date format not recognized for date: {date_str}")

def convert_days_to_year_moth_day(days):
    years = days // 365
    months = (days % 365) // 30
    remaining_days = (days % 365) % 30
    return years, months, remaining_days

print(employees_who_worked_together_most(csv_file_path))
